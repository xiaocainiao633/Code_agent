# 更新日志

本文档记录 CodeSage 项目的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.0.5] - 2025-12-18

### 修复

#### Python 后端 (backend-ai-agent)

- 🐛 修复 JSON 序列化错误
  - 在`ErrorResponse`模型中添加 datetime 的 JSON 编码器
  - 使用`model_dump(mode='json')`代替`.dict()`
  - 确保 datetime 对象正确序列化为 ISO 格式字符串
- 🐛 修复日志格式化错误
  - 转义异常消息中的花括号避免 loguru 格式化错误
  - 防止`KeyError: "'code'"`错误
- 💡 改进异常处理的稳定性

---

## [1.0.4] - 2025-12-18

### 修复

#### 代码分析页面

- 🐛 修复 Monaco Editor 类型错误
  - 修复`monaco.editor.setModelLanguage`调用
  - 添加类型断言避免 TypeScript 错误
  - 移除未使用的变量

#### 代码转换页面

- 🐛 修复转换结果无法显示的问题
  - 改进结果数据结构解析逻辑
  - 支持多种可能的数据格式
  - **修复字段名问题**：支持 `converted_code` 和 `converted` 两种字段名
  - 添加详细的日志输出
  - 修复编辑器初始化时加载保存的代码
- 💡 改进错误处理和提示

#### 测试生成页面

- 🐛 修复测试结果无法显示的问题
  - 改进结果数据结构解析逻辑
  - 支持多种可能的数据格式
  - 添加详细的日志输出
  - 修复编辑器初始化时加载保存的代码
- 💡 改进错误处理和提示

### 改进

- 💡 所有页面现在能正确处理不同格式的后端响应
- 💡 添加控制台日志帮助调试
- 💡 编辑器初始化时自动加载保存的结果

---

## [1.0.3] - 2025-12-18

### 改进

#### 控制台页面

- 💡 改进"查看"按钮样式
  - 从文本按钮改为主要按钮
  - 添加图标和"查看报告"文字
  - 提高可见性和可读性
- ✨ 添加任务报告对话框
  - 显示任务基本信息（类型、状态、创建时间、进度）
  - 显示错误信息（如果失败）
  - 根据任务类型显示不同的结果：
    - 代码分析：质量评分、复杂度、依赖、问题数量、业务逻辑摘要
    - 代码转换：转换完成提示
    - 测试生成：测试用例数、覆盖率
  - 显示原始 JSON 数据（可折叠）
  - 快速跳转到对应功能页面

---

## [1.0.2] - 2025-12-18

### 新增

#### 任务持久化

- ✨ 任务列表持久化到 localStorage
  - 自动保存所有任务到本地存储
  - 重新登录后任务不会丢失
  - 最多存储 100 个最近任务
- ✨ 任务列表页面 (`/tasks`)
  - 查看所有历史任务
  - 按状态筛选（全部/运行中/已完成/失败）
  - 搜索任务名称
  - 查看任务详情
  - 删除单个任务
  - 清空所有任务
  - 快速跳转到对应功能页面

#### 结果持久化

- ✨ 代码分析结果持久化
  - 保存分析结果到 localStorage
  - 页面切换后结果不丢失
  - 刷新页面后结果保留
- ✨ 代码转换结果持久化
  - 保存转换后的代码
  - 保存差异对比 HTML
  - 页面切换后结果不丢失
- ✨ 测试生成结果持久化
  - 保存生成的测试代码
  - 保存覆盖率数据
  - 保存测试用例列表
  - 页面切换后结果不丢失

### 修复

- 🐛 修复代码转换和测试生成响应时间过长的问题
  - 优化任务轮询机制
  - 添加结果缓存

### 改进

- 💡 控制台"查看全部"按钮现在跳转到任务列表页面
- 💡 所有任务自动保存到 localStorage
- 💡 任务结果自动持久化（如果启用了自动保存）

---

## [1.0.1] - 2025-12-18

### 修复

#### 代码分析页面

- 🐛 修复自动保存功能的 localStorage key 不匹配问题
  - 从 `general_settings` 改为 `codesage-settings.general`
  - 确保与 Settings 页面的存储结构一致
- 🧹 移除未使用的 `fileService` 导入

#### 代码转换页面

- ✨ 添加代码自动保存功能
  - 根据 Settings 中的自动保存设置保存/恢复原始代码
  - 保存目标语言选择
  - 使用防抖机制（1 秒延迟）避免频繁写入
- 🐛 修复文件上传功能
  - 使用 FileReader API 读取本地文件
  - 添加文件类型验证（支持 10 种代码文件类型）
  - 添加文件大小验证（最大 5MB）
  - 上传后自动保存（如果启用了自动保存）
- 🧹 移除未使用的 `fileService` 导入

#### 测试生成页面

- ✨ 添加代码自动保存功能
  - 根据 Settings 中的自动保存设置保存/恢复源代码
  - 保存测试框架选择
  - 使用防抖机制（1 秒延迟）避免频繁写入
- 🐛 修复文件上传功能
  - 使用 FileReader API 读取本地文件
  - 添加文件类型验证（支持 10 种代码文件类型）
  - 添加文件大小验证（最大 5MB）
  - 上传后自动保存（如果启用了自动保存）
- 🧹 移除未使用的 `fileService` 导入
- 🐛 移除重复的 `onUnmounted` 钩子

### 验证

- ✅ 代码分析页面：自动保存、表格样式、文件上传功能完整
- ✅ 代码转换页面：自动保存、文件上传功能完整
- ✅ 测试生成页面：自动保存、文件上传功能完整

---

## [1.0.0] - 2025-12-17

### 🎉 首次发布

#### 新增 - 用户认证系统

**后端 (Go)**

- ✨ SQLite 数据库集成
- ✨ 用户注册功能 (POST /api/v1/auth/register)
- ✨ 用户登录功能 (POST /api/v1/auth/login)
- ✨ JWT Token 认证机制
- ✨ bcrypt 密码加密
- ✨ 用户资料管理 (GET/PUT /api/v1/auth/profile)
- ✨ 密码修改功能 (POST /api/v1/auth/password/change)
- ✨ JWT 认证中间件
- ✨ 输入验证 (正则表达式)
- ✨ SQL 注入防护 (参数化查询)

**前端 (Vue 3)**

- ✨ 登录页面 (炫酷动画效果)
- ✨ 注册页面 (标签页切换)
- ✨ 认证 API 集成
- ✨ Token 自动管理
- ✨ 状态持久化 (localStorage/sessionStorage)
- ✨ 记住我功能
- ✨ 游客模式和本地模式
- ✨ 错误处理和用户提示

**数据库**

- ✨ users 表设计
- ✨ 用户名和邮箱索引
- ✨ 自动时间戳

**安全特性**

- 🔒 JWT Token 7 天有效期
- 🔒 bcrypt 密码加密 (成本因子 10)
- 🔒 Bearer Token 格式
- 🔒 CORS 白名单配置
- 🔒 密码不返回前端

**文档**

- 📚 认证 API 文档 (AUTH_API_DOCUMENTATION.md)
- 📚 部署指南 (AUTHENTICATION_SETUP.md)
- 📚 实现总结 (AUTHENTICATION_SUMMARY.md)
- 📚 快速启动指南 (QUICK_START.md)
- 📚 项目 README (README.md)
- 📚 测试脚本 (test_auth.bat)

#### 新增 - Go 后端工程层

**核心功能**

- ✨ 文件处理系统 (上传、验证、存储)
- ✨ 任务调度系统 (高并发、状态管理)
- ✨ Git 分析功能 (历史、贡献者、差异)
- ✨ WebSocket 实时通信
- ✨ Python AI Agent 集成
- ✨ 健康检查 API

**架构**

- 🏗️ 模块化设计 (internal/pkg 分离)
- 🏗️ 配置管理 (YAML + 环境变量)
- 🏗️ 结构化日志系统
- 🏗️ CORS 中间件
- 🏗️ 错误处理机制

#### 新增 - Python AI Agent 层

**AI 服务**

- ✨ LLM 服务 (Ollama 集成)
- ✨ 代码分析服务 (AST 解析)
- ✨ 代码转换服务 (Python 2→3)
- ✨ 测试生成服务 (pytest/unittest)

**功能**

- ✨ 15+ 种 Python 2→3 转换规则
- ✨ 复杂度计算
- ✨ 依赖提取
- ✨ 安全检测
- ✨ 业务逻辑推断

#### 新增 - Vue 3 前端

**界面**

- ✨ 深色主题
- ✨ 世界地图点阵背景动画
- ✨ 浮动粒子效果
- ✨ 玻璃态卡片设计
- ✨ 霓虹灯效果
- ✨ 响应式布局

**页面**

- ✨ 登录/注册页面
- ✨ 控制台页面
- ✨ 代码分析页面
- ✨ 代码转换页面
- ✨ 测试生成页面
- ✨ Git 分析页面
- ✨ 设置页面

**功能**

- ✨ Monaco Editor 集成
- ✨ 主题系统 (深色/浅色)
- ✨ 编辑器配置管理
- ✨ 自动保存功能
- ✨ WebSocket 实时更新
- ✨ 文件上传下载

---

## [0.9.0] - 2025-12-15

### 新增

#### 前端功能

- ✨ 个人资料管理
- ✨ 头像上传功能
- ✨ 修改密码对话框
- ✨ 社交账号链接

#### 主题系统

- ✨ 深色/浅色主题切换
- ✨ 自定义主色调
- ✨ 自定义强调色
- ✨ 全局字体设置
- ✨ 代码字体设置
- ✨ 动画效果开关
- ✨ 玻璃态效果
- ✨ 透明度调整
- ✨ 紧凑模式

#### Monaco 编辑器

- ✨ 编辑器主题配置
- ✨ 字体大小调节
- ✨ 字体粗细调节
- ✨ 行号显示开关
- ✨ 自动换行
- ✨ 缩进大小设置
- ✨ 代码补全
- ✨ 语法检查
- ✨ 迷你地图

---

## [0.8.0] - 2025-12-10

### 新增

#### Go 后端

- ✨ 文件处理系统
- ✨ 任务调度系统
- ✨ Git 分析功能
- ✨ WebSocket 通信

#### Python AI Agent

- ✨ 代码分析服务
- ✨ 代码转换服务
- ✨ 测试生成服务
- ✨ LLM 服务集成

---

## [0.7.0] - 2025-12-05

### 新增

#### 项目基础

- ✨ 项目结构初始化
- ✨ Go 模块管理
- ✨ Python 虚拟环境
- ✨ Vue 3 项目搭建

#### 配置

- ✨ YAML 配置文件
- ✨ 环境变量支持
- ✨ 日志系统

---

## 版本说明

### 版本号规则

- **主版本号 (Major)**: 不兼容的 API 修改
- **次版本号 (Minor)**: 向下兼容的功能性新增
- **修订号 (Patch)**: 向下兼容的问题修正

### 变更类型

- `新增` - 新功能
- `变更` - 对现有功能的变更
- `废弃` - 即将移除的功能
- `移除` - 已移除的功能
- `修复` - 问题修复
- `安全` - 安全相关的修复

---

## 路线图

### v1.1.0 (计划中)

**功能增强**

- [ ] Token 刷新机制
- [ ] 登录失败次数限制
- [ ] 邮箱验证功能
- [ ] 密码重置功能
- [ ] 设备管理功能

**性能优化**

- [ ] Redis 缓存集成
- [ ] 数据库连接池优化
- [ ] API 响应时间优化

### v1.2.0 (计划中)

**多语言支持**

- [ ] JavaScript 代码分析
- [ ] Java 代码分析
- [ ] C/C++ 代码分析

**AI 增强**

- [ ] 多智能体协作
- [ ] 更多 LLM 模型支持
- [ ] 代码质量评分

### v2.0.0 (计划中)

**企业功能**

- [ ] 团队协作
- [ ] 权限管理 (RBAC)
- [ ] 审计日志
- [ ] 数据统计和报表

**第三方集成**

- [ ] GitHub OAuth 登录
- [ ] Google OAuth 登录
- [ ] GitLab 集成
- [ ] Jira 集成

---

## 贡献者

感谢所有为 CodeSage 做出贡献的开发者！

---

**最后更新**: 2025-12-17  
**维护者**: CodeSage 开发团队
